<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="Author" content="Ishaque Junejo">
    <meta name="description" content="How adding a new hidden layer in Neural Network increased my confusion rather than increasing accuracy">
    <meta name="keywords" content="Neural Network, MNIST Dataset, Digit Recognition, Artificial Intelligence, Improving Neural Network, Hidden Neurons">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="ishaqjunejo.github.io">
    <meta name="twitter:creator:id" content="@mij_games">
    <meta name="twitter:title" content="Failed Attempt to Expand a Neural Network - Ishaque Junejo">
    <meta name="twitter:description" content="How adding a new hidden layer in Neural Network increased my confusion rather than increasing accuracy">
    <meta name="twitter:images" content="https://ishaqjunejo.github.io/Blogs/images/Neural-Network-Expansion.png">
    <meta name="og:title" content="Failed Attempt to Expand a Neural Network - Ishaque Junejo">
    <meta name="og:description" content="How adding a new hidden layer in Neural Network increased my confusion rather than increasing accuracy">
    <meta name="og:image" content="https://ishaqjunejo.github.io/Blogs/images/Neural-Network-Expansion.png">
    <link rel="stylesheet" href="../../style/blogs.css">
    <link rel="stylesheet" href="../../style/nav-bar.css">
    <link rel="stylesheet" href="../../style/code.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="../../images/Logo.png">
    <title>Failed Attempt to Expand a Neural Network - Ishaque Junejo</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-240697963-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-240697963-1');
    </script>
</head>
<body>
    <nav>
        <div class="logo">
            <a href="../../">
                <img src="../../images/Logo.png" alt="Home-Page">
            </a>
        </div>
        <ul>
            <li id="bars"><i class="fa fa-bars" onclick="NavBar()"></i></li>
            <li class="nav-links"><a href="../../#home" onclick="CloseNav()">Home</a></li>
            <li class="nav-links"><a href="../../#projects" onclick="CloseNav()">Projects</a></li>
            <li class="nav-links"><a href="../../#pixel-art" onclick="CloseNav()">Pixel Art</a></li>
            <li class="nav-links"><a href="../../#blogs" onclick="CloseNav()">Blogs</a></li>
        </ul>
    </nav>
    <div class="main-container">
        <img src="../images/Neural-Network-Expansion.png" alt="Banner Images" class="banner">
        <h1 class="title">A Failed Attempt to Expand my Neural Network</h1>
        <div class="content">
            <p class="date">03-December-2023</p>
            <p>
                Two months ago, I was working on a simple Neural Network project with the standard MNIST Dataset,
                which almost had an accuracy of 90%. That Neural Network had 784 input neurons in the form of each pixel,
                1 hidden layer with 10 neurons and 10 output neurons. <a href="..//Working-on-my-First-Neural-Network/">I also wrote about that</a>.
            </p>
            <h3>Let's Experiement</h3>
            <p>
                Because I made that Neural Network mostly by copying someone else's code and trying to understand it,
                I thought trying a few different things with it would be a good idea.
                One of those few different things was to attempt to expand this Neural Network.
            </p>
            <p>
                So the plan was to have the same number of Input and Output Neurons and 2 hidden layers with 16 Neurons each.
                And that's what I didâ€¦ at least attempted to do.
            </p>
            <p>
                Initializing the Weights and Biases.
            </p>
            <div class="code">
                <pre>
                    <code class="python">
<keyword class="reserve-1">def</keyword> <keyword class="function">init_parameters</keyword><keyword class="braces">(</keyword><keyword class="braces">)</keyword><keyword class="operation">:</keyword>
    weights_01 <keyword class="operation">=</keyword> <keyword class="from-class">np</keyword><keyword class="operation">.</keyword><keyword class="from-class">random</keyword><keyword class="operation">.</keyword><keyword class="function">rand</keyword><keyword class="braces">(</keyword><keyword class="numbers">16</keyword><keyword class="operation">,</keyword> <keyword class="numbers">784</keyword><keyword class="braces">)</keyword> <keyword class="operation">-</keyword> <keyword class="numbers">0.5</keyword>
    biases_01 <keyword class="operation">=</keyword> <keyword class="from-class">np</keyword><keyword class="operation">.</keyword><keyword class="from-class">random</keyword><keyword class="operation">.</keyword><keyword class="function">rand</keyword><keyword class="braces">(</keyword><keyword class="numbers">16</keyword><keyword class="operation">,</keyword> <keyword class="numbers">1</keyword><keyword class="braces">)</keyword> <keyword class="operation">-</keyword> <keyword class="numbers">0.5</keyword>
    weights_02 <keyword class="operation">=</keyword> <keyword class="from-class">np</keyword><keyword class="operation">.</keyword><keyword class="from-class">random</keyword><keyword class="operation">.</keyword><keyword class="function">rand</keyword><keyword class="braces">(</keyword><keyword class="numbers">16</keyword><keyword class="operation">,</keyword> <keyword class="numbers">16</keyword><keyword class="braces">)</keyword> <keyword class="operation">-</keyword> <keyword class="numbers">0.5</keyword>
    biases_02 <keyword class="operation">=</keyword> <keyword class="from-class">np</keyword><keyword class="operation">.</keyword><keyword class="from-class">random</keyword><keyword class="operation">.</keyword><keyword class="function">rand</keyword><keyword class="braces">(</keyword><keyword class="numbers">16</keyword><keyword class="operation">,</keyword> <keyword class="numbers">1</keyword><keyword class="braces">)</keyword> <keyword class="operation">-</keyword> <keyword class="numbers">0.5</keyword>
    weights_03 <keyword class="operation">=</keyword> <keyword class="from-class">np</keyword><keyword class="operation">.</keyword><keyword class="from-class">random</keyword><keyword class="operation">.</keyword><keyword class="function">rand</keyword><keyword class="braces">(</keyword><keyword class="numbers">10</keyword><keyword class="operation">,</keyword> <keyword class="numbers">16</keyword><keyword class="braces">)</keyword> <keyword class="operation">-</keyword> <keyword class="numbers">0.5</keyword>
    biases_03 <keyword class="operation">=</keyword> <keyword class="from-class">np</keyword><keyword class="operation">.</keyword><keyword class="from-class">random</keyword><keyword class="operation">.</keyword><keyword class="function">rand</keyword><keyword class="braces">(</keyword><keyword class="numbers">10</keyword><keyword class="operation">,</keyword> <keyword class="numbers">1</keyword><keyword class="braces">)</keyword> <keyword class="operation">-</keyword> <keyword class="numbers">0.5</keyword>
    <keyword class="reserve-2">return</keyword> weights_01<keyword class="operation">,</keyword> biases_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> biases_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> biases_03
                    </code>
                </pre>
            </div>
            <p>
                Forward Propagation Function.
            </p>
            <div class="code">
                <pre>
                    <code class="python">
<keyword class="reserve-1">def</keyword> <keyword class="function">forward_propagation</keyword><keyword class="braces">(</keyword>weights_01<keyword class="operation">,</keyword> biases_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> biases_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> biases_03<keyword class="operation">,</keyword> x<keyword class="braces">)</keyword><keyword class="operation">:</keyword>
    z1 <keyword class="operation">=</keyword> weights_01<keyword class="operation">.</keyword><keyword class="function">dot</keyword><keyword class="braces">(</keyword>x<keyword class="braces">)</keyword> <keyword class="operation">+</keyword> biases_01
    a1 <keyword class="operation">=</keyword> <keyword class="function">ReLU</keyword><keyword class="braces">(</keyword>z1<keyword class="braces">)</keyword>
    z2 <keyword class="operation">=</keyword> weights_02<keyword class="operation">.</keyword><keyword class="function">dot</keyword><keyword class="braces">(</keyword>a1<keyword class="braces">)</keyword> <keyword class="operation">+</keyword> biases_02
    a2 <keyword class="operation">=</keyword> <keyword class="function">ReLU</keyword><keyword class="braces">(</keyword>z2<keyword class="braces">)</keyword>
    z3 <keyword class="operation">=</keyword> weights_03<keyword class="operation">.</keyword><keyword class="function">dot</keyword><keyword class="braces">(</keyword>a2<keyword class="braces">)</keyword> <keyword class="operation">+</keyword> biases_03
    a3 <keyword class="operation">=</keyword> <keyword class="function">softmax</keyword><keyword class="braces">(</keyword>z3<keyword class="braces">)</keyword>
    <keyword class="reserve-2">return</keyword> z1<keyword class="operation">,</keyword> a1<keyword class="operation">,</keyword> z2<keyword class="operation">,</keyword> a2<keyword class="operation">,</keyword> z3<keyword class="operation">,</keyword> a3
                    </code>
                </pre>
            </div>
            <p>
                Backpropagation Function.
            </p>
            <div class="code">
                <pre>
                    <code class="python">
<keyword class="reserve-1">def</keyword> <keyword class="function">back_propagation</keyword><keyword class="braces">(</keyword>z1<keyword class="operation">,</keyword> a1<keyword class="operation">,</keyword> z2<keyword class="operation">,</keyword> a2<keyword class="operation">,</keyword> z3<keyword class="operation">,</keyword> a3<keyword class="operation">,</keyword> weights_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> x<keyword class="operation">,</keyword> y<keyword class="braces">)</keyword><keyword class="operation">:</keyword>
    one_hot_y <keyword class="operation">=</keyword> <keyword class="function">one_hot</keyword><keyword class="braces">(</keyword>y<keyword class="braces">)</keyword>
    dz3 <keyword class="operation">=</keyword> a3 <keyword class="operation">-</keyword> one_hot_y
    dweights_03 <keyword class="operation">=</keyword> <keyword class="numbers">1</keyword> <keyword class="operation">/</keyword> m <keyword class="operation">*</keyword> dz3<keyword class="operation">.</keyword><keyword class="function">dot</keyword><keyword class="braces">(</keyword>a2<keyword class="operation">.T</keyword><keyword class="braces">)</keyword>
    dbiases_03 <keyword class="operation">=</keyword> <keyword class="numbers">1</keyword> <keyword class="operation">/</keyword> m <keyword class="operation">*</keyword> <keyword class="from-class">np</keyword><keyword class="operation">.</keyword><keyword class="function">sum</keyword><keyword class="braces">(</keyword>dz3<keyword class="braces">)</keyword>
    dz2 <keyword class="operation">=</keyword> weights_03<keyword class="operation">.T</keyword><keyword class="operation">.</keyword><keyword class="function">dot</keyword><keyword class="braces">(</keyword>dz3<keyword class="braces">)</keyword> <keyword class="operation">*</keyword> <keyword class="function">ReLU_derivative</keyword><keyword class="braces">(</keyword>z2<keyword class="braces">)</keyword>
    dweights_02 <keyword class="operation">=</keyword> <keyword class="numbers">1</keyword> <keyword class="operation">/</keyword> m <keyword class="operation">*</keyword> dz2<keyword class="operation">.</keyword><keyword class="function">dot</keyword><keyword class="braces">(</keyword>a1<keyword class="operation">.T</keyword><keyword class="braces">)</keyword>
    dbiases_02 <keyword class="operation">=</keyword> <keyword class="numbers">1</keyword> <keyword class="operation">/</keyword> m <keyword class="operation">*</keyword> <keyword class="from-class">np</keyword><keyword class="operation">.</keyword><keyword class="function">sum</keyword><keyword class="braces">(</keyword>dz2<keyword class="braces">)</keyword>
    dz1 <keyword class="operation">=</keyword> weights_02<keyword class="operation">.T</keyword><keyword class="operation">.</keyword><keyword class="function">dot</keyword><keyword class="braces">(</keyword>dz2<keyword class="braces">)</keyword> <keyword class="operation">*</keyword> <keyword class="function">ReLU_derivative</keyword><keyword class="braces">(</keyword>z1<keyword class="braces">)</keyword>
    dweights_01 <keyword class="operation">=</keyword> <keyword class="numbers">1</keyword> <keyword class="operation">/</keyword> m <keyword class="operation">*</keyword> dz1<keyword class="operation">.</keyword><keyword class="function">dot</keyword><keyword class="braces">(</keyword>x<keyword class="operation">.T</keyword><keyword class="braces">)</keyword>
    dbiases_01 <keyword class="operation">=</keyword> <keyword class="numbers">1</keyword> <keyword class="operation">/</keyword> m <keyword class="operation">*</keyword> <keyword class="from-class">np</keyword><keyword class="operation">.</keyword><keyword class="function">sum</keyword><keyword class="braces">(</keyword>dz1<keyword class="braces">)</keyword>
    <keyword class="reserve-2">return</keyword> dweights_01<keyword class="operation">,</keyword> dbiases_01<keyword class="operation">,</keyword> dweights_02<keyword class="operation">,</keyword> dbiases_02<keyword class="operation">,</keyword> dweights_03<keyword class="operation">,</keyword> dbiases_03
                    </code>
                </pre>
            </div>
            <p>
                Parameters Updating Function.
            </p>
            <div class="code">
                <pre>
                    <code class="python">
<keyword class="reserve-1">def</keyword> <keyword class="function">update_parameters</keyword><keyword class="braces">(</keyword>weights_01<keyword class="operation">,</keyword> biases_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> biases_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> biases_03<keyword class="operation">,</keyword> dweights_01<keyword class="operation">,</keyword> dbiases_01<keyword class="operation">,</keyword> dweights_02<keyword class="operation">,</keyword> dbiases_02<keyword class="operation">,</keyword> dweights_03<keyword class="operation">,</keyword> dbiases_03<keyword class="operation">,</keyword> alpha<keyword class="braces">)</keyword><keyword class="operation">:</keyword>
    weights_01 <keyword class="operation">=</keyword> weights_01 <keyword class="operation">-</keyword> <keyword class="braces">(</keyword>dweights_01 <keyword class="operation">*</keyword> alpha<keyword class="braces">)</keyword>
    biases_01 <keyword class="operation">=</keyword> biases_01 <keyword class="operation">-</keyword> <keyword class="braces">(</keyword>dbiases_01 <keyword class="operation">*</keyword> alpha<keyword class="braces">)</keyword>
    weights_02 <keyword class="operation">=</keyword> weights_02 <keyword class="operation">-</keyword> <keyword class="braces">(</keyword>dweights_02 <keyword class="operation">*</keyword> alpha<keyword class="braces">)</keyword>
    biases_02 <keyword class="operation">=</keyword> biases_02 <keyword class="operation">-</keyword> <keyword class="braces">(</keyword>dbiases_02 <keyword class="operation">*</keyword> alpha<keyword class="braces">)</keyword>
    weights_03 <keyword class="operation">=</keyword> weights_03 <keyword class="operation">-</keyword> <keyword class="braces">(</keyword>dweights_03 <keyword class="operation">*</keyword> alpha<keyword class="braces">)</keyword>
    biases_03 <keyword class="operation">=</keyword> biases_03 <keyword class="operation">-</keyword> <keyword class="braces">(</keyword>dbiases_03 <keyword class="operation">*</keyword> alpha<keyword class="braces">)</keyword>
    <keyword class="reserve-2">return</keyword> weights_01<keyword class="operation">,</keyword> biases_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> biases_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> biases_03
                    </code>
                </pre>
            </div>
            <p>
                Activation Functions, ReLU Derivative, one hot encoding,
                and functions to get accuracy are supposed to remain the same.
            </p>
            <p>
                Now all of the functions needed can be used to train our Neural Network.
            </p>
            <div class="code">
                <pre>
                    <code class="python">
weights_01<keyword class="operation">,</keyword> biases_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> biases_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> biases_03 <keyword class="operation">=</keyword> <keyword class="function">init_parameters</keyword><keyword class="braces">(</keyword><keyword class="braces">)</keyword>
<keyword class="reserve-2">for</keyword> i <keyword class="reserve-2">in</keyword> <keyword class="from-class">range</keyword><keyword class="braces">(</keyword>iterations<keyword class="braces">)</keyword><keyword class="operation">:</keyword>
    z1<keyword class="operation">,</keyword> a1<keyword class="operation">,</keyword> z2<keyword class="operation">,</keyword> a2<keyword class="operation">,</keyword> z3<keyword class="operation">,</keyword> a3 <keyword class="operation">=</keyword> <keyword class="function">forward_propagation</keyword><keyword class="braces">(</keyword>weights_01<keyword class="operation">,</keyword> biases_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> biases_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> biases_03<keyword class="operation">,</keyword> x<keyword class="braces">)</keyword>
    dweights_01<keyword class="operation">,</keyword> dbiases_01<keyword class="operation">,</keyword> dweights_02<keyword class="operation">,</keyword> dbiases_02<keyword class="operation">,</keyword> dweights_03<keyword class="operation">,</keyword> dbiases_03 <keyword class="operation">=</keyword> <keyword class="function">back_propagation</keyword><keyword class="braces">(</keyword>z1<keyword class="operation">,</keyword> a1<keyword class="operation">,</keyword> z2<keyword class="operation">,</keyword> a2<keyword class="operation">,</keyword> z3<keyword class="operation">,</keyword> a3<keyword class="operation">,</keyword> weights_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> x<keyword class="operation">,</keyword> y<keyword class="braces">)</keyword>
    weights_01<keyword class="operation">,</keyword> biases_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> biases_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> biases_03 <keyword class="operation">=</keyword> <keyword class="function">update_parameters</keyword><keyword class="braces">(</keyword>weights_01<keyword class="operation">,</keyword> biases_01<keyword class="operation">,</keyword> weights_02<keyword class="operation">,</keyword> biases_02<keyword class="operation">,</keyword> weights_03<keyword class="operation">,</keyword> biases_03<keyword class="operation">,</keyword> dweights_01<keyword class="operation">,</keyword> dbiases_01<keyword class="operation">,</keyword> dweights_02<keyword class="operation">,</keyword> dbiases_02<keyword class="operation">,</keyword> dweights_03<keyword class="operation">,</keyword> dbiases_03<keyword class="operation">,</keyword> alpha<keyword class="braces">)</keyword>
    <keyword class="reserve-2">if</keyword> i <keyword class="operation">%</keyword> <keyword class="numbers">200</keyword> <keyword class="operation">==</keyword> <keyword class="numbers">0</keyword><keyword class="operation">:</keyword>
        <keyword class="function">print</keyword><keyword class="braces">(</keyword><keyword class="quotes">"Iteration: "</keyword><keyword class="operation">,</keyword> i<keyword class="braces">)</keyword>
        <keyword class="function">print</keyword><keyword class="braces">(</keyword><keyword class="quotes">"Accuracy: "</keyword><keyword class="operation">,</keyword> <keyword class="function">get_accuracy</keyword><keyword class="braces">(</keyword><keyword class="function">get_predictions</keyword><keyword class="braces">(</keyword>a2<keyword class="braces">)</keyword><keyword class="operation">,</keyword> Y_train<keyword class="braces">)</keyword> <keyword class="operation">*</keyword> <keyword class="numbers">100</keyword><keyword class="operation">,</keyword> <keyword class="quotes">"%"</keyword><keyword class="braces">)</keyword>
                    </code>
                </pre>
            </div>
            <p>
                Something that's left now is to run the program and
                see at what accuracy this Neural Network peaks. And, hit Run.
            </p>
            <img src="../images/Accuracy-Fluctuation.png" alt="Accuracy just fluctuates randomly" class="image">
            <p>
                So the problem here is that instead of accuracy going up,
                it just randomly fluctuates around without gradually increasing.
            </p>
            <p>
                I tried to analyze the code and try to find where I made the mistake.
                Eventually, I decided to look for the solution over to a magical place,
                yes I am talking about the Internet.
                After scrolling through a bunch of pages and source code,
                I got more confused rather than finding a solution.
                I still haven't found a solution to it.
            </p>
            <p>
                I have just changed its private repository into a <a href="https://github.com/IshaqJunejo/Digit-Recognizer">public repository</a>,
                so you can also have a look at it if you still find the problem unsolved and you have the answer,
                I would be thankful to you for having to learn from you.
            </p>
        </div>
    </div>
    <script src="../../script.js"></script>
</body>
</html>